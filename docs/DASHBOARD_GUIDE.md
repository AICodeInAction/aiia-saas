# 后台管理系统完整指南

## 📚 概述

后台管理系统是专为管理员设计的功能模块，基于 React 19、Next.js 15 和 Shadcn UI 构建，提供用户管理、角色管理等核心功能。只有拥有管理员权限的用户才能访问此系统。

## 🚀 快速开始

### 1. 环境要求
- Node.js 18+
- PostgreSQL 14+
- pnpm 8+

### 2. 初始化项目
```bash
# 启动开发服务器
pnpm run dev

# 运行种子数据脚本初始化角色
pnpm tsx prisma/seed.ts
```

### 3. 创建管理员账户
访问 `/auth/register` 注册一个账户，例如：
- 邮箱：admin@example.com
- 密码：password123
- 姓名：管理员

### 4. 分配管理员权限

#### 方式一：使用脚本分配
```bash
# 为注册的账户分配管理员角色
pnpm tsx scripts/assign-admin.ts admin@example.com
```

#### 方式二：数据库直接操作
1. 找到用户ID和管理员角色ID
2. 在 `user_roles` 表中插入记录

### 5. 访问后台管理
- 登录账户：`/auth/login`
- 访问Dashboard：`/dashboard`

## 📱 功能特性

### ✅ 已实现的功能

**🔐 权限控制系统**
- 基于角色的访问控制（RBAC）
- 细粒度的权限管理
- 管理员权限验证
- API权限检查

**📊 Dashboard主页**
- 数据统计卡片（用户数、活跃用户、角色数等）
- 快速操作面板
- 系统状态信息

**👥 用户管理**
- 用户列表展示（包含角色、状态、注册时间）
- 创建新用户表单
- 用户状态管理（活跃/非活跃/禁用）
- 分配用户角色

**🛡️ 角色管理**
- 角色列表展示（包含权限、用户数量）
- 角色权限显示
- 角色使用统计

**🎨 UI组件**
- 现代化侧边栏导航
- 响应式布局
- Shadcn UI组件集成
- 面包屑导航

## 📁 核心文件结构

```
app/dashboard/
├── page.tsx              # Dashboard主页
├── users/
│   ├── page.tsx          # 用户列表页
│   └── create/
│       └── page.tsx      # 创建用户页
└── roles/
    └── page.tsx          # 角色列表页

components/dashboard/
├── app-sidebar.tsx       # 侧边栏导航
├── site-header.tsx       # 顶部导航
└── admin-guard.tsx       # 权限守护组件

lib/
└── permissions.ts        # 权限管理工具

app/api/
├── auth/
│   └── check-admin/
│       └── route.ts      # 权限检查API
├── users/
│   └── route.ts          # 用户管理API
└── roles/
    └── route.ts          # 角色管理API
```

## 🔐 权限系统

### 角色定义
- **admin**: 系统管理员，拥有所有权限
- **user**: 普通用户，只有基础查看权限

### 权限列表与功能映射

| 权限 | 描述 | 功能 |
|------|------|------|
| `user:read` | 读取用户信息 | 查看用户列表 |
| `user:create` | 创建用户 | 添加新用户 |
| `user:update` | 更新用户信息 | 编辑用户资料 |
| `user:delete` | 删除用户 | 删除用户账户 |
| `role:read` | 读取角色信息 | 查看角色列表 |
| `role:create` | 创建角色 | 添加新角色 |
| `role:update` | 更新角色信息 | 编辑角色配置 |
| `role:delete` | 删除角色 | 删除角色 |
| `system:admin` | 系统管理员 | 访问后台管理 |

### 访问要求
- 用户必须已登录
- 用户必须具有管理员角色（`admin`）
- 用户必须拥有 `system:admin` 权限

## 🛠️ 使用流程

### 页面结构
- **仪表板** - 数据概览和快速操作
- **用户管理** - 用户相关功能
  - 用户列表
  - 添加用户
- **角色管理** - 角色相关功能
  - 角色列表
  - 添加角色
- **系统设置** - 系统配置

### 操作流程
1. **登录系统** - 使用管理员账户登录，系统自动验证权限
2. **访问Dashboard** - 登录后访问 `/dashboard`，查看系统概览信息
3. **管理用户** - 进入"用户管理"模块，查看、创建、编辑用户，分配角色
4. **管理角色** - 进入"角色管理"模块，查看现有角色，创建自定义角色和权限

## 🔌 API接口

### 权限检查
- `GET /api/auth/check-admin` - 检查管理员权限

### 用户管理
- `GET /api/users` - 获取用户列表
- `POST /api/users` - 创建新用户
- `PUT /api/users/{id}` - 更新用户信息
- `DELETE /api/users/{id}` - 删除用户

### 角色管理
- `GET /api/roles` - 获取角色列表
- `POST /api/roles` - 创建新角色
- `PUT /api/roles/{id}` - 更新角色信息
- `DELETE /api/roles/{id}` - 删除角色

## 🎨 设计特点

### UI/UX
- 参考 Shadcn UI Blocks 设计风格
- 现代化卡片布局
- 直观的数据展示
- 响应式设计，支持移动端

### 技术栈
- **前端**: React 19 + Next.js 15 (App Router)
- **UI框架**: Shadcn UI + Tailwind CSS
- **状态管理**: React Hooks
- **数据库**: PostgreSQL + Prisma ORM
- **认证**: NextAuth.js v5

## 🛡️ 安全性

### 认证机制
- 基于 NextAuth.js 的会话管理
- JWT Token 验证
- 服务端权限检查

### 权限验证
- 每个操作都有权限检查
- 防止权限提升攻击
- 审计日志记录

### 数据保护
- 密码加密存储
- 敏感信息过滤
- CSRF 保护

## 🚧 下一步开发建议

### 待完善功能
1. **用户编辑页面** - `/dashboard/users/[id]`
2. **角色创建/编辑** - `/dashboard/roles/create` 和 `/dashboard/roles/[id]`
3. **批量操作** - 批量删除用户、批量分配角色
4. **搜索和筛选** - 用户/角色搜索功能
5. **操作日志** - 记录管理员操作历史
6. **数据导出** - 用户数据Excel导出
7. **系统设置** - 基础配置管理

### 性能优化
1. **分页加载** - 大量数据的分页显示
2. **缓存策略** - API响应缓存
3. **乐观更新** - 前端状态乐观更新

### 安全增强
1. **操作确认** - 重要操作二次确认
2. **会话管理** - 会话超时处理
3. **审计日志** - 完整的操作审计

## ⚠️ 注意事项

1. **首次使用**：确保已运行 `pnpm tsx prisma/seed.ts` 初始化角色数据
2. **权限分配**：至少需要一个管理员用户才能开始使用
3. **数据备份**：重要操作前建议备份数据库
4. **权限变更**：角色权限变更会实时生效
5. **会话管理**：用户权限变更后需要重新登录

## 🔧 故障排除

### 常见问题

1. **无法访问Dashboard**
   - 检查用户是否已登录
   - 确认用户具有管理员角色
   - 验证数据库连接

2. **权限检查失败**
   - 检查用户角色分配
   - 确认角色权限配置
   - 查看服务器日志

3. **页面加载错误**
   - 检查网络连接
   - 确认API服务正常
   - 查看浏览器控制台

### 调试指南
1. 开启开发者工具
2. 查看网络请求
3. 检查控制台错误
4. 查看服务器日志

## 📝 更新日志

### v1.0.0
- 基础Dashboard功能
- 用户管理模块
- 角色管理模块
- 权限控制系统
- Shadcn UI集成

---

这个Dashboard系统提供了完整的后台管理基础架构，具有良好的扩展性和安全性，可以根据业务需求继续扩展功能。 